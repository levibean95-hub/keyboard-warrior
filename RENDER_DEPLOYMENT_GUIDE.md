# Render Backend Deployment Guide

## Prerequisites Completed ✅
- [x] Render MCP server configured in Claude Code
- [x] Dockerfile.render created for optimized deployment
- [x] render.yaml configuration file created
- [x] Health endpoint verified at `/health`

## Next Steps

### 1. Update Your Render API Key
Replace the placeholder API key in your Claude Code configuration:

```bash
# Update the API key in C:\Users\B\.claude.json
# Replace "YOUR_API_KEY_HERE" with your actual Render API key
```

### 2. Required Environment Variables in Render Dashboard

After deployment, go to your service's Environment settings in Render and set:

| Variable | Description | Required |
|----------|-------------|----------|
| `OPENAI_API_KEY` | Your OpenAI API key for AI responses | ✅ Yes |
| `CORS_ORIGIN` | Your Vercel frontend URL (e.g., `https://keyboard-warrior.vercel.app`) | ✅ Yes |
| `JWT_SECRET` | Auto-generated by Render | ✅ Auto |

### 3. Deploy to Render

#### Option A: Using Render Dashboard (Recommended)
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New +" → "Web Service"
3. Connect your GitHub repository
4. Render will auto-detect the `render.yaml` file
5. Click "Create Web Service"

#### Option B: Using Git Push
1. Commit your changes:
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin master
   ```
2. Render will auto-deploy if connected to your repo

#### Option C: Using Render CLI
```bash
# Install Render CLI if not already installed
npm install -g @render/cli

# Deploy
render deploy
```

### 4. Post-Deployment Configuration

1. **Get your backend URL**: It will be `https://keyboard-warrior-backend.onrender.com`

2. **Update Vercel Frontend Environment Variables**:
   - Go to your Vercel project settings
   - Add/Update: `VITE_API_URL=https://keyboard-warrior-backend.onrender.com`
   - Redeploy the frontend

3. **Test the deployment**:
   ```bash
   # Test health endpoint
   curl https://keyboard-warrior-backend.onrender.com/health
   
   # Expected response:
   # {"status":"healthy","timestamp":"2025-01-XX..."}
   ```

### 5. Monitor Your Service

- **Logs**: View in Render Dashboard → Your Service → Logs
- **Metrics**: View in Render Dashboard → Your Service → Metrics
- **Health**: Render automatically monitors the `/health` endpoint

## Important Notes

### Free Tier Limitations
- Service spins down after 15 minutes of inactivity
- First request after spin-down takes ~30 seconds
- Consider upgrading to Starter ($7/month) for always-on service

### Database Persistence
- SQLite database is stored at `/app/data/keyboard-warrior.db`
- Data persists between deploys on paid plans
- Free tier may lose data on redeploys

### Security Checklist
- [x] CORS configured for your specific frontend URL
- [x] Rate limiting enabled (100 requests per 15 minutes)
- [x] Helmet.js for security headers
- [x] JWT authentication configured
- [x] Environment variables properly secured

## Troubleshooting

### Common Issues

1. **CORS Errors**
   - Ensure `CORS_ORIGIN` in Render matches your Vercel URL exactly
   - Include protocol (https://) and no trailing slash

2. **Database Errors**
   - Check logs for SQLite permission issues
   - Ensure `/app/data` directory exists (handled by Dockerfile)

3. **OpenAI API Errors**
   - Verify `OPENAI_API_KEY` is set correctly in Render
   - Check OpenAI API quota and billing

4. **Build Failures**
   - Check TypeScript compilation errors in logs
   - Ensure all dependencies are in package.json

## Support Resources

- [Render Documentation](https://docs.render.com)
- [Render Status Page](https://status.render.com)
- [Render Community](https://community.render.com)

---

## Quick Reference Commands

```bash
# View logs
render logs keyboard-warrior-backend --tail

# SSH into service (Starter plan and above)
render ssh keyboard-warrior-backend

# Restart service
render restart keyboard-warrior-backend

# Check deployment status
render status keyboard-warrior-backend
```